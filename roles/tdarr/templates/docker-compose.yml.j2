version: '3.4'

services:
  tdarr:
    image: "{{ tdarr_docker_image }}:{{ tdarr_version }}"
    environment:
      PUID: "{{ media_user }}"
      PGID: "{{ media_group }}"
      TZ: "{{ default_timezone }}"
      webUIPort: "8265"
      serverPort: "8266"
      serverIP: "0.0.0.0"
    network_mode: bridge
    ports:
      - 8265:8265 # webUI port
      - 8266:8266 # server port
      - 8267:8267 # Internal node port
      - 8268:8268 # Example extra node port
    volumes:
      - /blacktalon/apps/tdarr/app:/home/Tdarr/Documents/Tdarr
      - /blacktalon/apps/tdarr/data:/var/lib/mongodb
      - /blacktalon/media:/home/Tdarr/media
      - transcode:/temp
      - /etc/localtime:/etc/localtime:ro

  tdarrnode:
    image: "{{ tdarr_node_docker_image }}:{{ tdarr_version }}"
    environment:
      PUID: "{{ media_user }}"
      PGID: "{{ media_group }}"
      TZ: "{{ default_timezone }}"
      nodeID: "MainNode"
      serverPort: "8266"
      serverIP: "0.0.0.0"
      nodeIP: "0.0.0.0"
    network_mode: service:tdarr
    volumes:
      - /blacktalon/apps/tdarr/app:/home/Tdarr/Documents/Tdarr
      - /blacktalon/apps/tdarr/data:/var/lib/mongodb
      - /blacktalon/media:/home/Tdarr/media
      - transcode:/temp
      - /etc/localtime:/etc/localtime:ro

volumes:
  transcode:
    external: true